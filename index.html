<html>
<head>
	<title>Temperature and humidity</title>

	<script src="./js/Chart.min.js"></script>
	<script src="./js/jquery-3.3.1.min.js"></script>

	<style>
		body {
			margin: 0;
			padding: 0;
			font-family: verdana;
			color: #fff;
			background-image: linear-gradient(135deg, #332e73, #554db3);
		}
		#container {
			width: 100vw;
			height: 100vh;
			display: flex;
			align-items: center;
		}
		#left-col {
			width: 75%;
		}
		#right-col {
			width: 25%;
			text-align: center;
		}
	</style>
</head>
<body>
	<div id="container">
		<div id="left-col">
			<canvas id="myChart"></canvas>
		</div>
		<div id="right-col">
			<h2>Temperature: <span id="temperature"></span>&deg;C</h2>
			<h2>Humidity: <span id="humidity"></span>%</h2>
		</div>
	</div>

	<script>
		$(document).ready(() => {
			let ctx = document.getElementById("myChart").getContext("2d");

			$.getJSON('./fetchData.php').then(data => {
				let len = data.length;
				let temperatureArr = [];
				let humidityArr = [];
				let timeArr = [];

				data.forEach(x => {
					temperatureArr.push(x.temperature);
					humidityArr.push(x.humidity);
					timeArr.push(x.time);
				});

				$("#temperature").text(temperatureArr[len-1]);
				$("#humidity").text(humidityArr[len-1]);

				let myChart = new Chart(ctx, {
					type: 'line',
					data: {
						labels: timeArr,
						datasets: [
							{
								label: 'Temperature',
								yAxisID: 'temp',
								backgroundColor: '#f4416e',
								borderColor: '#f4416e',
								fill: false,
								data: temperatureArr
							}, {
								label: 'Humidity',
								yAxisID: 'hum',
								backgroundColor: '#4286f4',
								borderColor: '#4286f4',
								fill: false,
								data: humidityArr
							}
						]
					},
					options: {
						scales: {
							yAxes: [
								{
									id: 'temp',
									position: 'left',
								}, {
									id: 'hum',
									position: 'right'
								}
							]
						}
					}
				});

				Chart.defaults.global.defaultFontColor = '#fff';
				Chart.defaults.global.defaultFontFamily = 'Verdana';
			});

		});
	</script>
</body>
</html>
